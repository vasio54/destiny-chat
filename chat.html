const newMessageAlert = document.getElementById('newMessageAlert');
chat.addEventListener('scroll', () => {
    const isAtBottom = chat.scrollHeight - chat.scrollTop <= chat.clientHeight + 10;
    if (!isAtBottom && !newMessageAlert.style.display) {
        newMessageAlert.style.display = 'block';
    } else {
        newMessageAlert.style.display = 'none';
    }
});
newMessageAlert.addEventListener('click', () => {
    chat.scrollTop = chat.scrollHeight;
    newMessageAlert.style.display = 'none';
});
socket.on('message', (data) => {
    console.log('收到訊息:', data);
    const messageContainer = document.createElement('div');
    messageContainer.classList.add('message-container');

    const messageDiv = document.createElement('div');
    messageDiv.classList.add('message');

    if (data.user === socket.id) {
        messageContainer.classList.add('self-container');
        messageDiv.classList.add('self');
    } else {
        messageContainer.classList.add('other-container');
        messageDiv.classList.add('other');
    }

    const textLength = data.text.length;
    if (textLength <= 10) {
        messageDiv.classList.add('short');
    } else if (textLength <= 30) {
        messageDiv.classList.add('medium');
    } else {
        messageDiv.classList.add('long');
    }

    messageDiv.textContent = data.text;
    messageContainer.appendChild(messageDiv);
    chat.appendChild(messageContainer);
    const isAtBottom = chat.scrollHeight - chat.scrollTop <= chat.clientHeight + 10;
    if (isAtBottom) {
        chat.scrollTop = chat.scrollHeight; // 滾動到最新訊息
    } else {
        newMessageAlert.style.display = 'block';
    }
});